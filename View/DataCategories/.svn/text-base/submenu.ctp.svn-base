<?php if (! empty($path)): ?>
	<ul class="path">
		<?php $first = true; ?>
		<?php foreach ($path as $group): ?>
			<li>
				<?php 
					$img = $first ? '' : $this->Html->image('arrow-turn-000-left.png');
					$category_id = $group['DataCategory']['id'];
					$first = false;
				?>
				<?php echo $this->Html->link(
					"$img<span>{$group['DataCategory']['name']}</span>",
					'#',
					array(
						'escape' => false,
						'id' => 'var_path_'.$category_id
					)
				); ?>
				<?php $this->Js->buffer("
					Event.observe('var_path_$category_id', 'click', function(event) {
						event.stop();
						var jsRequest = new Ajax.Updater(
							'variable_menu_{$section}_load', 
							'/data_categories/submenu/$section/$category_id', 
							{
								evalScripts: true,
								onCreate: function (transport) {
									$('variable_menu_{$section}_load').addClassName('loading');
								},
								onSuccess: function (transport) {
									$('variable_menu_{$section}_load').removeClassName('loading');
								}
							}
						);
					});
				"); ?>
			</li>
		<?php endforeach; ?>
	</ul>
	<hr />
<?php endif; ?>

<?php if (empty($menu)): ?>
	Error: No variables found.
<?php else: ?>
	<ul>
		<?php foreach ($menu as $node): ?>
			<li>
				<?php if ($node['is_group']): ?>
					<?php echo $this->Html->link(
						$this->Html->image('folder.gif').'<span>'.$node['name'].'...</span>',
						'#',
						array(
							'escape' => false,
							'id' => 'var_tree_group_'.$node['id']
						)
					); ?>
					<?php $this->Js->buffer("
						Event.observe('var_tree_group_{$node['id']}', 'click', function(event) {
							event.stop();
							var jsRequest = new Ajax.Updater(
								'variable_menu_{$section}_load', 
								'/data_categories/submenu/$section/{$node['id']}', 
								{
									evalScripts: true,
									onCreate: function (transport) {
										$('variable_menu_{$section}_load').addClassName('loading');
									},
									onSuccess: function (transport) {
										$('variable_menu_{$section}_load').removeClassName('loading');
									}
								}
							);
						});
					"); ?>
				<?php else: ?>
					<?php echo $this->Html->link(
						$this->Html->image('leaf.gif', array('class' => 'leaf')).
						$this->Html->image('plus-circle.png', array('class' => 'add')).
						'<span>'.$node['name'].'</span>',
						'#',
						array(
							'escape' => false,
							'id' => 'var_menu_'.$node['id']
						)
					); ?>
					<?php $this->Js->buffer("
						var selected_var = $('selected_var_{$node['id']}');
						if (selected_var) {
							$('var_menu_{$node['id']}').up('li').hide();
						}
						Event.observe('var_menu_{$node['id']}', 'click', function(event) {
							event.stop();
							selectVariable({$node['id']});
							updateSelectedParams();
							generateReport();
						});
					"); ?>
				<?php endif; ?>
			</li>
		<?php endforeach; ?>
	</ul>
<?php endif; ?>