<?php
/* Data: Dependency ratios (2000)
 * Source:
 * 		Census 2000 Summary File 1 (SF 1) 100-Percent Data; P12. SEX BY AGE [49] - Universe: Total population
 * 		Source ID: 52
 * Expected rows:
 * 		3 header rows before data
 * Expected columns (and data category ID#s):
 */
$categories = array(
	 0 => array('FIPS'),
 	 1 => array('Area name'),
 	 2 => array('Total (under 15 and 65+) Dependency Ratio per 100 people',		5741),
	 3 => array('Child (under age 15) Dependency Ratio per 100 people',			5742),
	 4 => array('Elderly (65+) Dependency Ratio per 100 people',				5743),
	 5 => array('Total (under 15 and 65+)',										5744),
	 6 => array('Under 15',														5745),
	 7 => array('Elderly (65+)',												291),
	 8 => array('Working age (15 to 64)',										5746)
);
include('../views/elements/import/helpers.php');
$category_id = null;
$source_id = 52;
$safety = true;
$overwrite_data = true;
$rows_per_page = 1;
$columns_before_data = null;
$header_row_count = 3;
$year = 2000;
$directory = 'C:\\Users\\gtwatson\\Documents\\EPA Grantwriters Site\\Demography';
$file_path = $directory.'\\05 - Dependency Ratios 2000.txt';
$import = new DataImport(compact(DataImport::getStandardConstructorParams(), 'year', 'categories'));

include('../views/elements/import/standard_header.php');

function processImportRow($import, $fields) {
	$fips = trim($fields[0]);
	list($loc_type_id, $loc_id) = $import->getLocInfoFromFIPS($fips); // Prints error messages on its own
	if (! $loc_id) {
		$auto = 0;
		exit();
	}
	$location = trim($fields[1]);
	echo '<table border="1" class="import"><thead><tr><td colspan="3">'.$location.' ('.$import->year.')</td></tr></thead><tbody>';
	foreach ($import->categories as $row_num => $category) {
		if (! isset($category[1])) {
			continue; // Skip categories with no ID specified
		}
		$survey_date = $import->year.'0000';
		$remove_these_characters = array('%', ',', '"');
		$value = trim(str_replace($remove_these_characters, '', $fields[$row_num]));
		$category_name = $category[0];
		$category_id = $category[1];
		echo "<tr><td>$category_name</td><td>$value</td>";
		$insert_result = $import->safeInsert(compact('category_id', 'survey_date', 'loc_type_id', 'loc_id', 'value'));
		if (! $import->printStandardResultCell($insert_result)) {
			echo '</tr></table></body></html>';
			exit();
		}
		echo '</tr>';
	}
}

$import->process();
?>

</tbody></table>

<?php include('../views/elements/import/standard_footer.php'); ?>